所有代码在本文件夹内。

以下的命令为选择三个点作为prompt，其中第一个是内距离最大点：
```
cd test
python task1.py -h
python task1.py -n 3 -c
```

额外需要的文件（不添加到仓库内）结构：
```
segment-anything/
├─ test/
│  ├─ BTCV
│  │  ├─ imagesTr
|  │  │  ├─ img0001.nii.gz
|  │  │  ├─ ...
│  │  ├─ labelsTr
|  │  │  ├─ label0001.nii.gz
|  │  │  ├─ ...
│  │  ├─ imagesTs
|  │  │  ├─ img0035.nii.gz
|  │  │  ├─ ...
│  │  ├─ labelsTs
|  │  │  ├─ label00035.nii.gz
|  │  │  ├─ ...
├─ sam_vit_h_4b8939.pth
```

35 号至 40 号数据用于测试，其余 24 个数据用于训练。

# Task1 & Task2
## Performance on the test set

以下默认 bbox 有扰动。

```
count: [151. 168. 168.  51. 132. 285. 181. 371. 330.  81. 126.  60.  72.]
```

*   Zero-shot，bbox：
```
dices: [0.8428579  0.9009713  0.9004321  0.5371831  0.7197999  0.8405922
0.7498948  0.8850961  0.83360696 0.49025273 0.663135   0.46940118
0.5473609 ]
average: 0.7215833
```
*   Zero-shot，3 点：
```
dices: [0.36662677 0.8565228  0.8444261  0.12316245 0.2086122  0.41079146
 0.3769895  0.842446   0.560129   0.16358607 0.21215807 0.02035188
 0.03132204]
average: 0.38593265
```

*   用 bbox 训练，bs=64，在 val 上最好的（0.8500545514），测试 bbox:
```
dices: [0.92774993 0.9287955  0.9328577  0.74688244 0.8518762  0.9331243
 0.891257   0.9389965  0.9012209  0.6723104  0.79497063 0.61453813
 0.69977057]
average: 0.83341163
```

*   用 bbox 训练，bs=64，在 val 上最好的（0.8500545514），测试颜色 viridis，bbox:
```
dices: [0.93378395 0.926089   0.93322384 0.73818564 0.8565882  0.9316387
 0.8940479  0.9332268  0.8974351  0.66965    0.8015549  0.59810674
 0.7182612 ]
average: 0.8332147
```

*   用 bbox 训练，bs=64，在 val 上最好的（0.8500545514），测试 3 点:
```
dices: [0.693901   0.8786644  0.88951075 0.25233212 0.2941513  0.7170947
 0.6167879  0.87261254 0.63818294 0.34011748 0.51280355 0.03694344
 0.10402999]
average: 0.52670246
```

*   用 bbox 训练，bs=10，在 val 上最好的（0.8483374633），测试 bbox:
```
dices: [0.9252311  0.92570466 0.92885536 0.743058   0.841118   0.9317673
 0.87818766 0.9398672  0.90489715 0.6834172  0.80287373 0.6045335
 0.6682711 ]
average: 0.82906014
```

*   用 3 点训练，bs=64，在 val 上（大概）最好的（0.8203931800），测试 3 点:
```
dices: [0.90544546 0.9178028  0.9209801  0.6786106  0.8175648  0.8974578
 0.8084798  0.93075824 0.8772588  0.6628848  0.7376614  0.55287963
 0.6892413 ]
average: 0.79977125
```

*   用 3 点训练，bs=64，在 val 上（大概）最好的（0.8203931800），测试 bbox:
```
dices: [0.873584   0.9143843  0.91996086 0.5909526  0.7627533  0.89812344
 0.80941117 0.8827119  0.8080632  0.4747784  0.6457024  0.5053456
 0.5779429 ]
average: 0.74336255
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [0] val 五次平均，前 134 个 epoch 最好的（model/hybrid/epoch-128-val-0.8343663946.pth），val dice 为 0.8625898772271144，测试 [0]:
```
dices: [0.9481968  0.9392312  0.9419046  0.7989793  0.8668984  0.94990194
 0.9093622  0.9417003  0.91294616 0.7200964  0.81821465 0.62988776
 0.75424194]
average: 0.85627395
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [1] val 五次平均，前 140 个 epoch 最好的（model/hybrid/epoch-119-val-0.8411638965.pth），val dice 为 0.794470599497771，测试 [1]:
```
dices: [0.8926895  0.9265972  0.9347542  0.58041716 0.78446186 0.8722137
 0.72102916 0.91472447 0.8507015  0.61198735 0.6621624  0.46463612
 0.6860495 ]
average: 0.7617249
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [3] val 五次平均，前 143 个 epoch 最好的（model/hybrid/epoch-85-val-0.8306728900.pth），val dice 为 0.8507289897639947，测试 [3]:
```
dices: [0.93061024 0.9316154  0.9385326  0.74756676 0.83512354 0.9255081
 0.8405288  0.9346645  0.8837643  0.74090433 0.75479853 0.6076176
 0.7433164 ]
average: 0.83188856
```


# Task3
## CNN classifier performance
*   3点训练的模型，bs=16，训练时image+gt_mask，val时image+pred_mask
```
val acc: 0.83
test acc: 0.8562956204379562
```

*   3点训练的模型，bs=16，训练时image+pred_mask，val时image+pred_mask
```
val acc: TODO
test acc: TODO
```

*   3点训练的模型，bs=16，训练时image+pred_mask，并采用数据增强，val时image+pred_mask
```
val acc: TODO
test acc: TODO
```

*   3点训练的模型，bs=16，训练时image+pred_mask，并采用数据增强，以及增加背景的训练，val时image+pred_mask
```
val acc: TODO
test acc: TODO
```
