所有代码在本文件夹内。

以下的命令为选择三个点作为prompt，其中第一个是内距离最大点：
```
cd test
python task1.py -h
python task1.py -n 3 -c
```

额外需要的文件（不添加到仓库内）结构：
```
segment-anything/
├─ test/
│  ├─ BTCV
│  │  ├─ imagesTr
|  │  │  ├─ img0001.nii.gz
|  │  │  ├─ ...
│  │  ├─ labelsTr
|  │  │  ├─ label0001.nii.gz
|  │  │  ├─ ...
│  │  ├─ imagesTs
|  │  │  ├─ img0035.nii.gz
|  │  │  ├─ ...
│  │  ├─ labelsTs
|  │  │  ├─ label00035.nii.gz
|  │  │  ├─ ...
├─ sam_vit_h_4b8939.pth
```

35 号至 40 号数据用于测试，其余 24 个数据用于训练。

# Task1 & Task2
## Performance on the test set

以下默认 bbox 有扰动。

```
count: [151. 168. 168.  51. 132. 285. 181. 371. 330.  81. 126.  60.  72.]
```

*   Zero-shot, [1] 五次平均：
```
dices: [0.62859005 0.8578109  0.8541461  0.23837097 0.33477348 0.599962
 0.4840344  0.8576455  0.5994794  0.36679548 0.3330037  0.04728938
 0.14645392]
average: 0.48833498
```

*   Zero-shot, [-1] 五次平均：
```
dices: [0.6454564  0.8578331  0.85728496 0.24921045 0.3518283  0.6169191
 0.5566708  0.85760355 0.60051614 0.44307232 0.34847474 0.05626457
 0.1634182 ]
average: 0.50804245
```

*   Zero-shot，[3] 五次平均：
```
dices: [0.71157765 0.8628792  0.85931873 0.3147179  0.41349828 0.6780834
 0.5922442  0.8444877  0.6313775  0.3618763  0.4225193  0.07989898
 0.20299034]
average: 0.5365746
```

*   Zero-shot，[-3] 五次平均：
```
dices: [0.7169697  0.86152095 0.85967135 0.3416527  0.4203206  0.68441504
 0.6068813  0.84662795 0.6306328  0.40249988 0.42841244 0.08427661
 0.2134408 ]
average: 0.54594785
```

*   Zero-shot，[0] 五次平均：
```
dices: [0.9085079  0.9027781  0.90260446 0.7351314  0.7755576  0.9115944
 0.8038911  0.8884289  0.85666037 0.5614826  0.7120903  0.5052922
 0.61600727]
average: 0.7753867
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [1] val 五次平均，前 140 个 epoch 最好的（model/hybrid/epoch-119-val-0.8411638965.pth），val dice 为 0.794470599497771，测试 [1] 五次平均:
```
dices: [0.8926895  0.9265972  0.9347542  0.58041716 0.78446186 0.8722137
 0.72102916 0.91472447 0.8507015  0.61198735 0.6621624  0.46463612
 0.6860495 ]
average: 0.7617249
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [3] val 五次平均，前 143 个 epoch 最好的（model/hybrid/epoch-85-val-0.8306728900.pth），val dice 为 0.8507289897639947，测试 [3] 五次平均:
```
dices: [0.93061024 0.9316154  0.9385326  0.74756676 0.83512354 0.9255081
 0.8405288  0.9346645  0.8837643  0.74090433 0.75479853 0.6076176
 0.7433164 ]
average: 0.83188856
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [0] val 五次平均，前 134 个 epoch 最好的（model/hybrid/epoch-128-val-0.8343663946.pth），val dice 为 0.8625898772271144，测试 [0] 五次平均:
```
dices: [0.9481968  0.9392312  0.9419046  0.7989793  0.8668984  0.94990194
 0.9093622  0.9417003  0.91294616 0.7200964  0.81821465 0.62988776
 0.75424194]
average: 0.85627395
```

以下是 3d Dice：

*   Zero-shot, [1] 五次平均：
```
[0.47624008 0.70855625 0.64815505 0.02869082 0.05184137 0.48497316
 0.32021689 0.6299112  0.12729223 0.12552615 0.14536343 0.00807931
 0.00632955]
0.2893211914950805
```

*   Zero-shot, [-1] 五次平均：
```
[0.50783719 0.71876435 0.66312573 0.02892965 0.06537899 0.49436889
 0.43425702 0.68393871 0.13015461 0.25673811 0.14146861 0.00910818
 0.00665911]
0.31851762670551675
```

*   Zero-shot，[3] 五次平均：
```
[0.62803281 0.76605409 0.75733625 0.05564324 0.08090442 0.56246697
 0.44707012 0.65423503 0.18354732 0.08260103 0.23980269 0.01844385
 0.01130028]
0.34518754614615604
```

*   Zero-shot，[-3] 五次平均：
```
[0.63102759 0.76617068 0.76792428 0.05199918 0.0864226  0.57570827
 0.47975199 0.64817078 0.1841224  0.09988805 0.24575685 0.01944478
 0.01114168]
0.35134839510201565
```

*   Zero-shot，[0] 五次平均：
```
[0.94462129 0.91435148 0.91669782 0.78186867 0.81299052 0.91521934
 0.82063283 0.86160243 0.85622505 0.44115038 0.69205658 0.50356354
 0.61023524]
0.7747088586986168
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [1] val 五次平均，前 181 个 epoch 最好的（model/hybrid/epoch-152-val-0.8381975279.pth），val dice 为 0.7766901054733414，测试 [1] 五次平均:
```
[0.92301611 0.93992764 0.94595862 0.40234985 0.75273643 0.8903397
 0.74283425 0.89029787 0.82954904 0.51275542 0.6639891  0.3990294
 0.6735302 ]
0.7358702797468957
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [-1] val 五次平均，前 181 个 epoch 最好的（model/hybrid/epoch-101-val-0.8399459625.pth），val dice 为 0.8177189442840598，测试 [-1] 五次平均:
```
[0.95290038 0.94150693 0.94650328 0.44598255 0.8245941  0.94704401
 0.79822666 0.90559313 0.88219052 0.54395114 0.75078491 0.48974475
 0.6898647 ]
0.7783759281983298
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [3] val 五次平均，前 181 个 epoch 最好的（model/hybrid/epoch-94-val-0.8277385593.pth），val dice 为 0.848540153045556，测试 [3] 五次平均:
```
[0.95555892 0.94478989 0.94865073 0.75293777 0.83186844 0.93824425
 0.84191959 0.92891313 0.87095989 0.67682336 0.77416807 0.6220213
 0.7500999 ]
0.8336119414257575
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [-3] val 五次平均，前 181 个 epoch 最好的（model/hybrid/epoch-94-val-0.8277385593.pth），val dice 为 0.8533142935028866，测试 [-3] 五次平均:
```
[0.95632206 0.94523202 0.9486092  0.74782931 0.83787115 0.94744951
 0.85518455 0.92524029 0.88501369 0.70991658 0.78689742 0.64982488
 0.74692315]
0.8417164451380306
```

*   数据增强、[0, 1, -1, 3, -3] 混合训练，在 [0] val 五次平均，前 181 个 epoch 最好的（model/hybrid/epoch-105-val-0.8264309937.pth），val dice 为 0.8569876828827371，测试 [0] 五次平均:
```
[0.96444225 0.9484358  0.9496701  0.83794358 0.87615675 0.95890835
 0.91093083 0.9380323  0.91274259 0.70177924 0.83376725 0.63970199
 0.76659011]
0.8645462410403337
```


# Task3
## CNN classifier performance
*   3点训练的模型，bs=16，训练时image+gt_mask，val时image+pred_mask
```
val acc: 0.83
test acc: 0.8562956204379562
```

*   3点训练的模型，bs=16，训练时image+pred_mask，val时image+pred_mask
```
val acc: TODO
test acc: TODO
```

*   3点训练的模型，bs=16，训练时image+pred_mask，并采用数据增强，val时image+pred_mask
```
val acc: TODO
test acc: TODO
```

*   3点训练的模型，bs=16，训练时image+pred_mask，并采用数据增强，以及增加背景的训练，val时image+pred_mask
```
val acc: TODO
test acc: TODO
```
